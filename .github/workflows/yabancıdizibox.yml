name: YabanciDiziBox Otomasyonu

on:
  schedule:
    # Her gün UTC saatiyle 04:00'da (Türkiye saatiyle sabah 07:00 civarı) çalışır
    - cron: '0 4 * * *'
  workflow_dispatch: # Manuel çalıştırma butonu ekler

permissions:
  contents: write # Dosya kaydetmek için yazma izni

jobs:
  scrape_job:
    runs-on: ubuntu-latest

    steps:
      - name: Depoyu Çek (Checkout)
        uses: actions/checkout@v3

      - name: Python Kurulumu
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # --- KÜTÜPHANELER BURADA YÜKLENİYOR ---
      # requirements.txt dosyasına gerek yok, pip install direkt burada çalışır.
      - name: Gerekli Kütüphaneleri Yükle
        run: |
          python -m pip install --upgrade pip
          pip install cloudscraper requests

      - name: Botu Çalıştır (yabancıdizibox.py)
        run: python yabancıdizibox.py

      - name: Dosyaları Commit ve Push Yap
        run: |
          git config --global user.name 'GitHub Action Bot'
          git config --global user.email 'action@github.com'
          
          # "yabancidizibox" klasörünü ve içindekileri ekle
          git add yabancidizibox/
          
          # Eğer değişiklik varsa commit at ve gönder, yoksa hata verme
          git diff --quiet && git diff --staged --quiet || (git commit -m "Liste güncellendi: $(date)" && git push)
